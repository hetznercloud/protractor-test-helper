# Protractor Test Helper

[![Build Status](https://travis-ci.com/hetznercloud/protractor-test-helper.svg?branch=master)](https://travis-ci.com/hetznercloud/protractor-test-helper)
[![Greenkeeper badge](https://badges.greenkeeper.io/hetznercloud/protractor-test-helper.svg)](https://greenkeeper.io/)

This library provides functions which help to create robust and reliable end-to-end tests with protractor
and reduces the pain of end-to-end tests to a minimum.
All provided action helpers perform checks that the element is in the correct state before the actual task is performed.

**Features**

* Robust actions like `click`, `sendKeys` or `hover` which wait for their elements before the action is performed
* Lots of `waitforâ€¦` functions to avoid `sleep`
* Helper to open and close windows, tabs, popups, etc
* Utilities like the `flowLog` function, which logs exactly in the moment when it is expected to log: when the previous web driver action was performed, and not when the `it` block is called.
* Most of the actions have a retry logic inside, which retries the action 3 (or configurable number of) times before an error is thrown
* Custom matcher like `.toBePresent()` or `toBeDisplayed()`; 
* Provides better error messages with more details
* All functions which interact with elements accept either `ElementFinder`, `Locator` or `string` as target parameter
* Ready for tests written with [`async` / `await`](https://github.com/angular/protractor/blob/master/docs/async-await.md) (every function returns a promise)
* Definition files are included for `TypeScript`

## Table of Contents
* [Example usage](#example)
* [Installation](#installation)
* [Contributing](#contributing)
* [License](#license)
* [Matchers](#matchers)
* [API](#api)

<a id="example"></a>
## Example usage
```javascript
const { click, waitForTextToBe, sendKeys, getText } = require('protractor-test-helper');

describe('readme example', () => {
    // Simple example - better would be a Page Object
    const firstNumber = element(by.model('first'));
    const secondNumber = element(by.model('second'));
    const goButton = element(by.id('gobutton'));
    const latestResult = element(by.binding('latest'));

    beforeEach(() => {
        browser.get('http://juliemr.github.io/protractor-demo/');
    });

    it('should add one and two', () => {
        sendKeys(firstNumber, '1');
        sendKeys(secondNumber, '2');
        click(goButton);

        waitForTextToBe(latestResult, '3');
        expect(getText(latestResult), '3');
    });
});
```

For more examples please have a look into the `test` folder.

<a id="installation"></a>
## Installation
```bash
npm install @hetznercloud/protractor-test-helper --save-dev
```

or

```bash
yarn add @hetznercloud/protractor-test-helper -D
```

To use the matcher you have to call the install function in your `protractor.config`:

```js
exports.config = {
    onPrepare() {
        //...
        require('@hetznercloud/protractor-test-helper/').installMatcher();
    },
};
```

<a id="contributing"></a>
## Contributing
Pull requests are warmly welcome. Minor fixes will be merged as soon as possible.
Please ask before you make any significant changes (e.g. implementing new features, refactoring code, etc), 
otherwise you risk spending a lot of time working on something that the project's developers might not want to merge into the project.

### Tests
Tests can be started with:

```bash
yarn test
```

After adding new functionality please add new test cases as well. The test app is located under `testapp/` and consists of a simple `Angular` application. 
You can simply start it with `yarn start`.

### Code Style
Please respect the linting rules and run `yarn pretty:write` after applying changes to the code. 
Prettier is an "opinionated code formatter". More information [about prettier](https://prettier.io/).

### Docs
The readme and docs are autogenerated. After adding or updating functions please run

```bash
yarn readme:update
```

The first part of the readme is stored under `_docs/README.base.md`.
Please do not make changes directly in the `README.md` file.

<a id="license"></a>
## License
MIT license

<a id="matchers"></a>

## Matchers
```js
expect(ElementFinder | Locator | string).toBeDisplayed();
expect(ElementFinder | Locator | string).toBePresent();
```
